{
    "nodes": [
        {
            "id": 0,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::636:::0:::.data()",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::636:::0:::.data()"
            ],
            "size_info_available": null,
            "visited": false,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "dependent"
            ]
        },
        {
            "id": 1,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::498:::0:::",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::498:::0:::"
            ],
            "size_info_available": null,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": []
        },
        {
            "id": 2,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::641:::0:::.data()",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::641:::0:::.data()"
            ],
            "size_info_available": null,
            "visited": false,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "dependent"
            ]
        },
        {
            "id": 3,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::365:::0:::",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::365:::0:::"
            ],
            "size_info_available": null,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": []
        },
        {
            "id": 4,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::365:::12:::auto buf = std::to_array<int>(",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::365:::12:::auto buf = std::to_array<int>(",
                "include-system-header:::tools/clang/spanify/tests/array-external-call-original.cc:::-1:::-1:::array",
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::388:::1:::})"
            ],
            "size_info_available": true,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "source",
                "sink"
            ]
        },
        {
            "id": 5,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::498:::14:::auto buf2 = std::to_array<char>(",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::498:::14:::auto buf2 = std::to_array<char>(",
                "include-system-header:::tools/clang/spanify/tests/array-external-call-original.cc:::-1:::-1:::array",
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::526:::1:::})"
            ],
            "size_info_available": true,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "source",
                "sink"
            ]
        },
        {
            "id": 6,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1100:::0:::.data()",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1100:::0:::.data()"
            ],
            "size_info_available": null,
            "visited": false,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "dependent"
            ]
        },
        {
            "id": 7,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::956:::0:::",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::956:::0:::"
            ],
            "size_info_available": null,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": []
        },
        {
            "id": 8,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::858:::6:::base::span<char>",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::858:::6:::base::span<char>",
                "include-user-header:::tools/clang/spanify/tests/array-external-call-original.cc:::-1:::-1:::base/containers/span.h"
            ],
            "size_info_available": null,
            "visited": false,
            "debug_info": {
                "rewrite_applied": false,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": []
        },
        {
            "id": 9,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1096:::0:::<empty>",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1096:::0:::<empty>",
                "include-user-header:::tools/clang/spanify/tests/array-external-call-original.cc:::-1:::-1:::base/containers/span.h"
            ],
            "size_info_available": true,
            "visited": false,
            "debug_info": {
                "rewrite_applied": false,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "sink"
            ]
        },
        {
            "id": 10,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::956:::13:::std::array<char, 10> data",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::956:::13:::std::array<char, 10> data",
                "include-system-header:::tools/clang/spanify/tests/array-external-call-original.cc:::-1:::-1:::array"
            ],
            "size_info_available": true,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "source",
                "sink"
            ]
        },
        {
            "id": 11,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1181:::13:::std::array<char, 10> data",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1181:::13:::std::array<char, 10> data",
                "include-system-header:::tools/clang/spanify/tests/array-external-call-original.cc:::-1:::-1:::array"
            ],
            "size_info_available": true,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "source",
                "sink"
            ]
        },
        {
            "id": 12,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1181:::0:::",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1181:::0:::"
            ],
            "size_info_available": null,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": []
        },
        {
            "id": 13,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1684:::16:::const std::string_view buf",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1684:::16:::const std::string_view buf",
                "include-system-header:::tools/clang/spanify/tests/array-external-call-original.cc:::-1:::-1:::string_view"
            ],
            "size_info_available": true,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "source",
                "sink"
            ]
        },
        {
            "id": 14,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1684:::0:::",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1684:::0:::"
            ],
            "size_info_available": null,
            "visited": true,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": []
        },
        {
            "id": 15,
            "replacement": "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1778:::0:::.data()",
            "replacements": [
                "r:::tools/clang/spanify/tests/array-external-call-original.cc:::1778:::0:::.data()"
            ],
            "size_info_available": null,
            "visited": false,
            "debug_info": {
                "rewrite_applied": true,
                "original_is_buffer": false,
                "original_size_info_available": null
            },
            "node_types": [
                "dependent"
            ]
        }
    ],
    "links": [
        {
            "source": 0,
            "target": 1
        },
        {
            "source": 2,
            "target": 3
        },
        {
            "source": 4,
            "target": 3
        },
        {
            "source": 5,
            "target": 1
        },
        {
            "source": 6,
            "target": 7
        },
        {
            "source": 8,
            "target": 9
        },
        {
            "source": 10,
            "target": 7
        },
        {
            "source": 11,
            "target": 12
        },
        {
            "source": 13,
            "target": 14
        },
        {
            "source": 15,
            "target": 14
        }
    ],
    "source": {
        "content": "// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n#include <cstdint>\n#include <cstring>\n#include <iterator>\n\nint UnsafeIndex();  // This function might return an out-of-bound index.\n\nvoid fct() {\n  // Expected rewrite:\n  // auto buf = std::to_array<int>({1, 2, 3, 4});\n  int buf[] = {1, 2, 3, 4};\n  buf[UnsafeIndex()] = 1;\n\n  // Expected rewrite:\n  // auto buf2 = std::to_array<char>({'x', 'y', 'z'});\n  char buf2[] = {'x', 'y', 'z'};\n  buf2[UnsafeIndex()] = 'a';\n\n  // Expected rewrite:\n  // memcpy(buf2.data(), buf.data(), 1);\n  memcpy(buf2, buf, 1);\n}\n\n#define UNSAFE_BUFFER_USAGE [[clang::unsafe_buffer_usage]]\n\nclass File {\n public:\n  File() = default;\n  // No rewrite expected because this has UNSAFE_BUFFER_USAGE.\n  UNSAFE_BUFFER_USAGE int ReadAtCurrentPos(char* data, int size);\n};\n\nvoid fct2() {\n  // Expected rewrite:\n  // std::array<char, 10> data;\n  char data[10];\n  data[UnsafeIndex()] = 'a';\n  File f;\n  // Expected rewrite:\n  // f.ReadAtCurrentPos(data.data(), 10);\n  f.ReadAtCurrentPos(data, 10);\n}\n\nvoid fct3() {\n  // Expected rewrite:\n  // std::array<char, 10> data;\n  char data[10];\n  data[UnsafeIndex()] = 'a';\n  // No rewrite expected. This is because std::size() etc. accepts std::array.\n  std::ignore = std::size(data);\n  std::ignore = std::begin(data);\n  std::ignore = std::end(data);\n  std::ignore = std::empty(data);\n  std::swap(data, data);\n  std::ranges::find(data, 'a');\n  std::ignore = std::ranges::min(data);\n}\n\nvoid fct4() {\n  // Adding .data() works for std::string_view rewrites too.\n  // Expected rewrite:\n  // const std::string_view buf = \"123456789\";\n  const char buf[] = \"123456789\";\n  std::ignore = buf[UnsafeIndex()];\n  std::ignore = memcmp(buf, \"xxx456789\", 3);\n}\n",
        "file_path": "tools/clang/spanify/tests/array-external-call-original.cc",
        "rev": "733eff2098bf2f25b1cf0c182a3ee8beda9ef880"
    },
    "sources": [
        {
            "content": null,
            "file_path": "tools/clang/spanify/tests/array-external-call-original.cc"
        }
    ]
}