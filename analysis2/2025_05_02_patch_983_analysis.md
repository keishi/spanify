# Build Failure Analysis: 2025_05_02_patch_983

## First error

Overlapping replacements: ./services/device/usb/usb_descriptors_unittest.cc at offset 13839, length 13: "(kIAD4.size() * sizeof(decltype(kIAD4)::value_type))" and offset 13845, length 0: ".data()"

## Category
Overlapping replacements between RewriteArraySizeof and AppendDataCall.

## Reason
The rewriter attempts to apply two replacements to the same region of code. One replacement is generated by `RewriteArraySizeof` to replace `sizeof(kIAD4)` by `(kIAD4.size() * sizeof(decltype(kIAD4)::value_type))`. The other replacement is generated by `AppendDataCall` to add `.data()` to `kIAD4`. Since `sizeof(kIAD4)` and `kIAD4` partially overlaps, the two replacements conflict.

## Solution
The rewriter should avoid generating conflicting replacements. `AppendDataCall` should only be called when the array is passed as a parameter to a function that expects a pointer, and `RewriteArraySizeof` should not be called if `AppendDataCall` is already called.

## Note
None