# Build Failure: 2025_05_02_patch_762

## Chromium Revision

`a3ffac36a0fd4cbdc95cd5ec879816b9634a1d56`

## Code Changes (Diff)

```diff
diff --git a/gpu/command_buffer/tests/compressed_texture_test.cc b/gpu/command_buffer/tests/compressed_texture_test.cc
index ee230c18af66a..ac2ec1fedfe54 100644
--- a/gpu/command_buffer/tests/compressed_texture_test.cc
+++ b/gpu/command_buffer/tests/compressed_texture_test.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/40285824): Remove this and convert code to safer constructs.
 #pragma allow_unsafe_buffers
@@ -242,8 +244,7 @@ TEST_P(CompressedTextureTest, Draw) {
     origin[0] = kBlockSize * i;
     ToRGB888(kPalette[i], expected_rgba);
     EXPECT_TRUE(GLTestHelper::CheckPixels(origin[0], origin[1], kBlockSize,
-                                          kBlockSize, 0, expected_rgba,
-                                          nullptr));
+                                          kBlockSize, 0, expected_rgba, {}));
   }
   GLTestHelper::CheckGLError("CompressedTextureTest.Draw", __LINE__);
 }
diff --git a/gpu/command_buffer/tests/gl_angle_shader_pixel_local_storage_unittest.cc b/gpu/command_buffer/tests/gl_angle_shader_pixel_local_storage_unittest.cc
index 2f4eb33e1cea6..3ffd51320de7d 100644
--- a/gpu/command_buffer/tests/gl_angle_shader_pixel_local_storage_unittest.cc
+++ b/gpu/command_buffer/tests/gl_angle_shader_pixel_local_storage_unittest.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/390223051): Remove C-library calls to fix the errors.
 #pragma allow_unsafe_libc_calls
@@ -291,7 +293,7 @@ void main() {
   glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D,
                          tex, 0);
   EXPECT_TRUE(GLTestHelper::CheckPixels(
-      0, 0, 10, 10, 0, std::array<uint8_t, 4>{255, 0, 255, 0}.data(), nullptr));
+      0, 0, 10, 10, 0, std::array<uint8_t, 4>{255, 0, 255, 0}.data(), {}));
 }
 
 // Verifies that the PLS ban on FBO 0 is also enforced when FBO "0" is emulated
diff --git a/gpu/command_buffer/tests/gl_bind_uniform_location_unittest.cc b/gpu/command_buffer/tests/gl_bind_uniform_location_unittest.cc
index 925b5ed32afb7..7fc8d6b7bb09d 100644
--- a/gpu/command_buffer/tests/gl_bind_uniform_location_unittest.cc
+++ b/gpu/command_buffer/tests/gl_bind_uniform_location_unittest.cc
@@ -7,6 +7,7 @@
 #include <GLES2/gl2extchromium.h>
 #include <stdint.h>
 
+#include "base/containers/span.h"
 #include "gpu/command_buffer/tests/gl_manager.h"
 #include "gpu/command_buffer/tests/gl_test_utils.h"
 #include "testing/gmock/include/gmock/gmock.h"
@@ -96,7 +97,7 @@ TEST_P(BindUniformLocationTest, Basic) {
 
   static const uint8_t expected[] = {64, 128, 192, 255};
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kResolution, kResolution, 1,
-                                        expected, nullptr));
+                                        expected, {}));
 
   GLTestHelper::CheckGLError("no errors", __LINE__);
 }
@@ -269,7 +270,7 @@ TEST_P(BindUniformLocationTest, MAYBE_Compositor) {
 
   static const uint8_t expected[] = {204, 204, 204, 204};
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kResolution, kResolution, 1,
-                                        expected, nullptr));
+                                        expected, {}));
 
   GLTestHelper::CheckGLError("no errors", __LINE__);
 }
diff --git a/gpu/command_buffer/tests/gl_chromium_framebuffer_multisample_unittest.cc b/gpu/command_buffer/tests/gl_chromium_framebuffer_multisample_unittest.cc
index 358fd8d7d59f6..2d650b1435482 100644
--- a/gpu/command_buffer/tests/gl_chromium_framebuffer_multisample_unittest.cc
+++ b/gpu/command_buffer/tests/gl_chromium_framebuffer_multisample_unittest.cc
@@ -7,6 +7,7 @@
 #include <GLES2/gl2extchromium.h>
 #include <stdint.h>
 
+#include "base/containers/span.h"
 #include "gpu/command_buffer/tests/gl_manager.h"
 #include "gpu/command_buffer/tests/gl_test_utils.h"
 #include "testing/gmock/include/gmock/gmock.h"
@@ -144,8 +145,8 @@ TEST_F(GLChromiumFramebufferMultisampleTest, DrawAndResolve) {
   const uint8_t black[] = {0, 0, 0, 0};
   glBindFramebuffer(GL_READ_FRAMEBUFFER, resolve_fbo);
   EXPECT_TRUE(GLTestHelper::CheckPixels(width / 4, (3 * height) / 4, 1, 1, 0,
-                                        green, nullptr));
-  EXPECT_TRUE(GLTestHelper::CheckPixels(width - 1, 0, 1, 1, 0, black, nullptr));
+                                        green, {}));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(width - 1, 0, 1, 1, 0, black, {}));
 }
 
 }  // namespace gpu
diff --git a/gpu/command_buffer/tests/gl_clear_framebuffer_unittest.cc b/gpu/command_buffer/tests/gl_clear_framebuffer_unittest.cc
index 6ae914e77237b..e6fddd6636d6b 100644
--- a/gpu/command_buffer/tests/gl_clear_framebuffer_unittest.cc
+++ b/gpu/command_buffer/tests/gl_clear_framebuffer_unittest.cc
@@ -3,6 +3,8 @@
 // found in the LICENSE file.
 
 #ifndef GL_GLEXT_PROTOTYPES
+#include "base/containers/span.h"
+
 #define GL_GLEXT_PROTOTYPES
 #endif
 
@@ -114,8 +116,8 @@ TEST_P(GLClearFramebufferTest, ClearColor) {
 
   // Verify.
   const uint8_t expected[] = {255, 128, 64, 128};
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 1 /* tolerance */, expected,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 1 /* tolerance */, expected, {}));
 }
 
 TEST_P(GLClearFramebufferTest, ClearColorWithMask) {
@@ -125,8 +127,8 @@ TEST_P(GLClearFramebufferTest, ClearColorWithMask) {
 
   // Verify.
   const uint8_t expected[] = {255, 0, 0, 0};
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, expected,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, expected, {}));
 }
 
 // crbug.com/434094
@@ -145,8 +147,8 @@ TEST_P(GLClearFramebufferTest, ClearColorWithScissor) {
 
   // Verify.
   const uint8_t expected[] = {255, 255, 255, 255};
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, expected,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, expected, {}));
 
   glScissor(0, 0, 0, 0);
   glEnable(GL_SCISSOR_TEST);
@@ -154,8 +156,8 @@ TEST_P(GLClearFramebufferTest, ClearColorWithScissor) {
   glClear(GL_COLOR_BUFFER_BIT);
 
   // Verify - no changes.
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, expected,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, expected, {}));
 }
 #endif
 
@@ -173,7 +175,7 @@ TEST_P(GLClearFramebufferTest, ClearDepthStencil) {
   const uint8_t kRed[] = {255, 0, 0, 255};
   const uint8_t kGreen[] = {0, 255, 0, 255};
   EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kRed, nullptr));
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kRed, {}));
 
   glClearStencil(kStencilRef);
   glClear(GL_STENCIL_BUFFER_BIT);
@@ -185,13 +187,13 @@ TEST_P(GLClearFramebufferTest, ClearDepthStencil) {
   DrawQuad();
   // Verify - stencil should have failed, so still red.
   EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kRed, nullptr));
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kRed, {}));
 
   glStencilFunc(GL_EQUAL, kStencilRef, 0xFFFFFFFF);
   DrawQuad();
   // Verify - stencil should have passed, so green.
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kGreen,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kGreen, {}));
 
   glEnable(GL_DEPTH_TEST);
   glClearDepthf(0.0f);
@@ -201,15 +203,15 @@ TEST_P(GLClearFramebufferTest, ClearDepthStencil) {
   SetDrawColor(1.0f, 0.0f, 0.0f, 1.0f);
   DrawQuad();
   // Verify - depth test should have failed, so still green.
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kGreen,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kGreen, {}));
 
   glClearDepthf(0.9f);
   glClear(GL_DEPTH_BUFFER_BIT);
   DrawQuad();
   // Verify - depth test should have passed, so red.
   EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kRed, nullptr));
+      GLTestHelper::CheckPixels(0, 0, 1, 1, 0 /* tolerance */, kRed, {}));
 }
 
 TEST_P(GLClearFramebufferTest, SeparateFramebufferClear) {
@@ -237,7 +239,7 @@ TEST_P(GLClearFramebufferTest, SeparateFramebufferClear) {
 
   gl_.BindOffscreenFramebuffer(GL_READ_FRAMEBUFFER);
   const uint8_t kRed[] = {255, 0, 0, 255};
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, kRed, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, kRed, {}));
 
   // Bind complete, but smaller read framebuffer, should not affect clear.
   GLuint texture;
@@ -257,7 +259,7 @@ TEST_P(GLClearFramebufferTest, SeparateFramebufferClear) {
 
   gl_.BindOffscreenFramebuffer(GL_READ_FRAMEBUFFER);
   const uint8_t kGreen[] = {0, 255, 0, 255};
-  EXPECT_TRUE(GLTestHelper::CheckPixels(3, 3, 1, 1, 0, kGreen, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(3, 3, 1, 1, 0, kGreen, {}));
 }
 
 class ES3ClearBufferTest : public testing::Test {
diff --git a/gpu/command_buffer/tests/gl_copy_texture_CHROMIUM_unittest.cc b/gpu/command_buffer/tests/gl_copy_texture_CHROMIUM_unittest.cc
index 209d523f7fde5..7759705687460 100644
--- a/gpu/command_buffer/tests/gl_copy_texture_CHROMIUM_unittest.cc
+++ b/gpu/command_buffer/tests/gl_copy_texture_CHROMIUM_unittest.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/40285824): Remove this and convert code to safer constructs.
 #pragma allow_unsafe_buffers
@@ -155,7 +157,11 @@ std::string GetFragmentShaderSource(GLenum target, GLenum format, bool is_es3) {
   return source;
 }
 
-void setColor(uint8_t r, uint8_t g, uint8_t b, uint8_t a, uint8_t* color) {
+void setColor(uint8_t r,
+              uint8_t g,
+              uint8_t b,
+              uint8_t a,
+              base::span<uint8_t> color) {
   color[0] = r;
   color[1] = g;
   color[2] = b;
@@ -165,8 +171,8 @@ void setColor(uint8_t r, uint8_t g, uint8_t b, uint8_t a, uint8_t* color) {
 void getExpectedColorAndMask(GLenum src_internal_format,
                              GLenum dest_internal_format,
                              const uint8_t* color,
-                             uint8_t* expected_color,
-                             uint8_t* expected_mask) {
+                             base::span<uint8_t> expected_color,
+                             base::span<uint8_t> expected_mask) {
   uint8_t adjusted_color[4];
   switch (src_internal_format) {
     case GL_ALPHA:
@@ -291,14 +297,14 @@ void getTextureDataAndExpectedRGBAs(FormatType src_format_type,
                                     GLsizei height,
                                     std::vector<uint8_t>* texture_data,
                                     std::vector<uint8_t>* expected_rgba_pixels,
-                                    uint8_t* expected_mask) {
+                                    base::span<uint8_t> expected_mask) {
   DCHECK(texture_data);
   DCHECK(expected_rgba_pixels);
 
   const uint32_t src_channel_count = gles2::GLES2Util::ElementsPerGroup(
       src_format_type.format, src_format_type.type);
   constexpr uint8_t color[4] = {1u, 63u, 127u, 255u};
-  uint8_t expected_color[4];
+  std::array<uint8_t, 4> expected_color;
   constexpr uint8_t alt_color[4] = {200u, 100u, 0u, 255u};
 
   getExpectedColorAndMask(src_format_type.internal_format,
@@ -366,7 +372,7 @@ void getTextureDataAndExpectedRGBAs(FormatType src_format_type,
         reinterpret_cast<uint32_t*>(texture_data->data());
     for (uint32_t p = 0; p < num_pixels; ++p) {
       texture_data32[p] = color_rgb10_a2;
-      memcpy(expected_rgba_pixels->data() + p * 4, expected_color, 4);
+      memcpy(expected_rgba_pixels->data() + p * 4, expected_color.data(), 4);
     }
     return;
   }
@@ -827,7 +833,7 @@ TEST_P(GLCopyTextureCHROMIUMTest, Basic) {
   EXPECT_EQ(static_cast<GLenum>(GL_FRAMEBUFFER_COMPLETE),
             glCheckFramebufferStatus(GL_FRAMEBUFFER));
 
-  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, pixels, nullptr);
+  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, pixels, {});
   EXPECT_TRUE(GL_NO_ERROR == glGetError());
 }
 
@@ -931,7 +937,7 @@ TEST_P(GLCopyTextureCHROMIUMTest, ImmutableTexture) {
         EXPECT_EQ(static_cast<GLenum>(GL_FRAMEBUFFER_COMPLETE),
                   glCheckFramebufferStatus(GL_FRAMEBUFFER));
 
-        GLTestHelper::CheckPixels(0, 0, 1, 1, 0, pixels, nullptr);
+        GLTestHelper::CheckPixels(0, 0, 1, 1, 0, pixels, {});
         EXPECT_TRUE(GL_NO_ERROR == glGetError());
       }
       glDeleteTextures(2, textures_);
@@ -1257,7 +1263,7 @@ TEST_F(GLCopyTextureCHROMIUMTest, RedefineDestinationTexture) {
   EXPECT_EQ(static_cast<GLenum>(GL_FRAMEBUFFER_COMPLETE),
             glCheckFramebufferStatus(GL_FRAMEBUFFER));
 
-  GLTestHelper::CheckPixels(1, 1, 1, 1, 0, &pixels[12], nullptr);
+  GLTestHelper::CheckPixels(1, 1, 1, 1, 0, &pixels[12], {});
 
   glDeleteTextures(2, textures_);
   glDeleteFramebuffers(1, &framebuffer_id_);
@@ -1482,7 +1488,7 @@ TEST_P(GLCopyTextureCHROMIUMTest, FBOStatePreserved) {
   uint8_t expected_color[4] = {255u, 255u, 0, 255u};
   glClearColor(1.0, 1.0, 0, 1.0);
   glClear(GL_COLOR_BUFFER_BIT);
-  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color, nullptr);
+  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color, {});
 
   if (copy_type == TexImage) {
     glCopyTextureCHROMIUM(textures_[0], 0, GL_TEXTURE_2D, textures_[1], 0,
@@ -1496,12 +1502,12 @@ TEST_P(GLCopyTextureCHROMIUMTest, FBOStatePreserved) {
   EXPECT_TRUE(glIsFramebuffer(framebuffer_id));
 
   // Ensure that reading from the framebuffer produces correct pixels.
-  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color, nullptr);
+  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color, {});
 
   uint8_t expected_color2[4] = {255u, 0, 255u, 255u};
   glClearColor(1.0, 0, 1.0, 1.0);
   glClear(GL_COLOR_BUFFER_BIT);
-  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color2, nullptr);
+  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color2, {});
 
   GLint bound_fbo = 0;
   glGetIntegerv(GL_FRAMEBUFFER_BINDING, &bound_fbo);
@@ -1590,9 +1596,9 @@ TEST_P(GLCopyTextureCHROMIUMTest, ProgramStatePreservation) {
       0, 0, 0, 0,
   };
   glClear(GL_COLOR_BUFFER_BIT);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, zero, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, zero, {}));
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected, {}));
 
   // Call copyTextureCHROMIUM
   uint8_t pixels[1 * 4] = {255u, 0u, 0u, 255u};
@@ -1612,9 +1618,9 @@ TEST_P(GLCopyTextureCHROMIUMTest, ProgramStatePreservation) {
 
   // test using program after
   glClear(GL_COLOR_BUFFER_BIT);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, zero, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, zero, {}));
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected, {}));
 
   glDeleteTextures(2, textures_);
   glDeleteFramebuffers(1, &framebuffer_id_);
@@ -1803,10 +1809,10 @@ TEST_F(GLCopyTextureCHROMIUMTest, CopySubTextureOffset) {
   uint8_t red[1 * 4] = {255u, 0u, 0u, 255u};
   uint8_t green[1 * 4] = {0u, 255u, 0u, 255u};
   uint8_t blue[1 * 4] = {0u, 0u, 255u, 255u};
-  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, transparent, nullptr);
-  GLTestHelper::CheckPixels(1, 1, 1, 1, 0, red, nullptr);
-  GLTestHelper::CheckPixels(1, 0, 1, 1, 0, green, nullptr);
-  GLTestHelper::CheckPixels(0, 1, 1, 1, 0, blue, nullptr);
+  GLTestHelper::CheckPixels(0, 0, 1, 1, 0, transparent, {});
+  GLTestHelper::CheckPixels(1, 1, 1, 1, 0, red, {});
+  GLTestHelper::CheckPixels(1, 0, 1, 1, 0, green, {});
+  GLTestHelper::CheckPixels(0, 1, 1, 1, 0, blue, {});
   EXPECT_TRUE(GL_NO_ERROR == glGetError());
 
   glDeleteTextures(2, textures_);
diff --git a/gpu/command_buffer/tests/gl_cube_map_texture_unittest.cc b/gpu/command_buffer/tests/gl_cube_map_texture_unittest.cc
index 8a24e8cd71407..c533510f4b2ae 100644
--- a/gpu/command_buffer/tests/gl_cube_map_texture_unittest.cc
+++ b/gpu/command_buffer/tests/gl_cube_map_texture_unittest.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/40285824): Remove this and convert code to safer constructs.
 #pragma allow_unsafe_buffers
@@ -117,7 +119,7 @@ TEST_P(GLCubeMapTextureTest, DISABLED_ReadPixels) {
   EXPECT_EQ(static_cast<GLenum>(GL_FRAMEBUFFER_COMPLETE),
             glCheckFramebufferStatus(GL_FRAMEBUFFER));
 
-  GLTestHelper::CheckPixels(0, 0, width_, width_, 0, pixels_, nullptr);
+  GLTestHelper::CheckPixels(0, 0, width_, width_, 0, pixels_, {});
   EXPECT_EQ(static_cast<GLenum>(GL_NO_ERROR), glGetError());
 }
 
diff --git a/gpu/command_buffer/tests/gl_ext_blend_func_extended_unittest.cc b/gpu/command_buffer/tests/gl_ext_blend_func_extended_unittest.cc
index c5f615de9ca5a..ea9dee9eee18a 100644
--- a/gpu/command_buffer/tests/gl_ext_blend_func_extended_unittest.cc
+++ b/gpu/command_buffer/tests/gl_ext_blend_func_extended_unittest.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/40285824): Remove this and convert code to safer constructs.
 #pragma allow_unsafe_buffers
@@ -202,9 +204,8 @@ class EXTBlendFuncExtendedDrawTest : public testing::TestWithParam<bool> {
                          GL_ONE_MINUS_SRC1_ALPHA_EXT>(kDst, kSrc, kSrc1, color);
 
     EXPECT_TRUE(GLTestHelper::CheckPixels(kWidth / 4, (3 * kHeight) / 4, 1, 1,
-                                          1, color, nullptr));
-    EXPECT_TRUE(
-        GLTestHelper::CheckPixels(kWidth - 1, 0, 1, 1, 1, color, nullptr));
+                                          1, color, {}));
+    EXPECT_TRUE(GLTestHelper::CheckPixels(kWidth - 1, 0, 1, 1, 1, color, {}));
   }
 
  protected:
diff --git a/gpu/command_buffer/tests/gl_ext_srgb_unittest.cc b/gpu/command_buffer/tests/gl_ext_srgb_unittest.cc
index ba12d6e87db0e..6e03d557335f2 100644
--- a/gpu/command_buffer/tests/gl_ext_srgb_unittest.cc
+++ b/gpu/command_buffer/tests/gl_ext_srgb_unittest.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/390223051): Remove C-library calls to fix the errors.
 #pragma allow_unsafe_libc_calls
@@ -71,10 +73,10 @@ TEST_F(GLEXTSRGBTest, TexImageSRGBALPHAFormat) {
   EXPECT_EQ(static_cast<GLenum>(GL_FRAMEBUFFER_COMPLETE),
             glCheckFramebufferStatus(GL_FRAMEBUFFER));
 
-  GLTestHelper::CheckPixels(0, 0, kSubImageX, kHeight, 0, kImageColor, nullptr);
-  GLTestHelper::CheckPixels(0, 0, kWidth, kSubImageY, 0, kImageColor, nullptr);
+  GLTestHelper::CheckPixels(0, 0, kSubImageX, kHeight, 0, kImageColor, {});
+  GLTestHelper::CheckPixels(0, 0, kWidth, kSubImageY, 0, kImageColor, {});
   GLTestHelper::CheckPixels(kSubImageX, kSubImageY, kSubImageWidth,
-                            kSubImageHeight, 0, kSubImageColor, nullptr);
+                            kSubImageHeight, 0, kSubImageColor, {});
 }
 
 }  // namespace gpu
diff --git a/gpu/command_buffer/tests/gl_lose_context_chromium_unittest.cc b/gpu/command_buffer/tests/gl_lose_context_chromium_unittest.cc
index 74bdd60023ebb..e955c36f20b82 100644
--- a/gpu/command_buffer/tests/gl_lose_context_chromium_unittest.cc
+++ b/gpu/command_buffer/tests/gl_lose_context_chromium_unittest.cc
@@ -7,6 +7,7 @@
 #include <GLES2/gl2extchromium.h>
 #include <stdint.h>
 
+#include "base/containers/span.h"
 #include "gpu/command_buffer/service/feature_info.h"
 #include "gpu/command_buffer/tests/gl_manager.h"
 #include "gpu/command_buffer/tests/gl_test_utils.h"
@@ -54,18 +55,16 @@ TEST_F(GLLoseContextTest, ShareGroup) {
       GLTestHelper::kCheckClearValue, GLTestHelper::kCheckClearValue,
   };
   // Expect the read will fail.
-  EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_no_draw, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_no_draw, {}));
   gl1b_.MakeCurrent();
   // Expect the read will fail.
-  EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_no_draw, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_no_draw, {}));
   gl2_.MakeCurrent();
   uint8_t expected_draw[] = {
       0, 0, 0, 0,
   };
   // Expect the read will succeed.
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_draw, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_draw, {}));
 }
 
 }  // namespace gpu
diff --git a/gpu/command_buffer/tests/gl_map_buffer_range_unittest.cc b/gpu/command_buffer/tests/gl_map_buffer_range_unittest.cc
index b24ff627057b5..c1782c8263cdf 100644
--- a/gpu/command_buffer/tests/gl_map_buffer_range_unittest.cc
+++ b/gpu/command_buffer/tests/gl_map_buffer_range_unittest.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/40285824): Remove this and convert code to safer constructs.
 #pragma allow_unsafe_buffers
@@ -121,13 +123,13 @@ TEST_F(ES3MapBufferRangeTest, DrawArraysAndInstanced) {
   glDrawArrays(GL_TRIANGLES, 0, 6);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawArraysInstancedANGLE(GL_TRIANGLES, 0, 6, kPrimCount);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 
   glMapBufferRange(GL_ARRAY_BUFFER, 0, 6, GL_MAP_READ_BIT);
   GLTestHelper::CheckGLError("no errors", __LINE__);
@@ -136,13 +138,13 @@ TEST_F(ES3MapBufferRangeTest, DrawArraysAndInstanced) {
   glDrawArrays(GL_TRIANGLES, 0, 6);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawArraysInstancedANGLE(GL_TRIANGLES, 0, 6, kPrimCount);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   // The following test is necessary to make sure draw calls do not just check
   // bound buffers, but actual buffers that are attached to the enabled vertex
@@ -153,13 +155,13 @@ TEST_F(ES3MapBufferRangeTest, DrawArraysAndInstanced) {
   glDrawArrays(GL_TRIANGLES, 0, 6);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawArraysInstancedANGLE(GL_TRIANGLES, 0, 6, kPrimCount);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   glBindBuffer(GL_ARRAY_BUFFER, buffer);
   glUnmapBuffer(GL_ARRAY_BUFFER);
@@ -169,13 +171,13 @@ TEST_F(ES3MapBufferRangeTest, DrawArraysAndInstanced) {
   glDrawArrays(GL_TRIANGLES, 0, 6);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawArraysInstancedANGLE(GL_TRIANGLES, 0, 6, kPrimCount);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 }
 
 TEST_F(ES3MapBufferRangeTest, DrawElementsAndInstanced) {
@@ -202,14 +204,14 @@ TEST_F(ES3MapBufferRangeTest, DrawElementsAndInstanced) {
   glDrawElements(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawElementsInstancedANGLE(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0,
                                kPrimCount);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 
   glMapBufferRange(GL_ARRAY_BUFFER, 0, 6, GL_MAP_READ_BIT);
   GLTestHelper::CheckGLError("no errors", __LINE__);
@@ -218,14 +220,14 @@ TEST_F(ES3MapBufferRangeTest, DrawElementsAndInstanced) {
   glDrawArrays(GL_TRIANGLES, 0, 6);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawElementsInstancedANGLE(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0,
                                kPrimCount);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   // The following test is necessary to make sure draw calls do not just check
   // bound buffers, but actual buffers that are attached to the enabled vertex
@@ -236,14 +238,14 @@ TEST_F(ES3MapBufferRangeTest, DrawElementsAndInstanced) {
   glDrawArrays(GL_TRIANGLES, 0, 6);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawElementsInstancedANGLE(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0,
                                kPrimCount);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   glBindBuffer(GL_ARRAY_BUFFER, buffers[0]);
 
@@ -254,14 +256,14 @@ TEST_F(ES3MapBufferRangeTest, DrawElementsAndInstanced) {
   glDrawElements(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawElementsInstancedANGLE(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0,
                                kPrimCount);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 
   glMapBufferRange(GL_ELEMENT_ARRAY_BUFFER, 0, 6, GL_MAP_READ_BIT);
   GLTestHelper::CheckGLError("no errors", __LINE__);
@@ -270,14 +272,14 @@ TEST_F(ES3MapBufferRangeTest, DrawElementsAndInstanced) {
   glDrawElements(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawElementsInstancedANGLE(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0,
                                kPrimCount);
   EXPECT_EQ(static_cast<GLenum>(GL_INVALID_OPERATION), glGetError());
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kBlackColor, nullptr));
+                                        kBlackColor, {}));
 
   glUnmapBuffer(GL_ELEMENT_ARRAY_BUFFER);
   GLTestHelper::CheckGLError("no errors", __LINE__);
@@ -286,14 +288,14 @@ TEST_F(ES3MapBufferRangeTest, DrawElementsAndInstanced) {
   glDrawElements(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 
   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
   glDrawElementsInstancedANGLE(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, 0,
                                kPrimCount);
   GLTestHelper::CheckGLError("no errors", __LINE__);
   EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kCanvasSize, kCanvasSize, 1,
-                                        kRedColor, nullptr));
+                                        kRedColor, {}));
 }
 
 TEST_F(ES3MapBufferRangeTest, ReadPixels) {
diff --git a/gpu/command_buffer/tests/gl_pointcoord_unittest.cc b/gpu/command_buffer/tests/gl_pointcoord_unittest.cc
index 53b285095c931..74f5cc2acd7cb 100644
--- a/gpu/command_buffer/tests/gl_pointcoord_unittest.cc
+++ b/gpu/command_buffer/tests/gl_pointcoord_unittest.cc
@@ -8,6 +8,7 @@
 
 #include <array>
 
+#include "base/containers/span.h"
 #include "build/build_config.h"
 #include "gpu/command_buffer/tests/gl_manager.h"
 #include "gpu/command_buffer/tests/gl_test_utils.h"
@@ -146,7 +147,7 @@ TEST_F(PointCoordTest, MAYBE_RenderTo) {
               static_cast<uint8_t>(s * 255),
               static_cast<uint8_t>((1 - t) * 255), 0, 255,
           };
-          GLTestHelper::CheckPixels(xf, yf, 1, 1, 4, color, nullptr);
+          GLTestHelper::CheckPixels(xf, yf, 1, 1, 4, color, {});
         }
       }
     }
diff --git a/gpu/command_buffer/tests/gl_program_unittest.cc b/gpu/command_buffer/tests/gl_program_unittest.cc
index 7817cc87d812f..15b1abd1d2c85 100644
--- a/gpu/command_buffer/tests/gl_program_unittest.cc
+++ b/gpu/command_buffer/tests/gl_program_unittest.cc
@@ -7,6 +7,7 @@
 #include <GLES2/gl2extchromium.h>
 #include <stdint.h>
 
+#include "base/containers/span.h"
 #include "gpu/command_buffer/service/context_group.h"
 #include "gpu/command_buffer/tests/gl_manager.h"
 #include "gpu/command_buffer/tests/gl_test_utils.h"
@@ -131,8 +132,7 @@ TEST_F(GLProgramTest, NewShaderInCurrentProgram) {
   uint8_t expected_color[] = {
       0, 0, 255, 255,
   };
-  EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color, {}));
   GLTestHelper::CheckGLError("no errors", __LINE__);
 }
 
@@ -200,8 +200,7 @@ TEST_F(GLProgramTest, UniformsInCurrentProgram) {
   uint8_t expected_color[] = {
       0, 0, 255, 255,
   };
-  EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_color, {}));
   GLTestHelper::CheckGLError("no errors", __LINE__);
 }
 
diff --git a/gpu/command_buffer/tests/gl_stream_draw_unittest.cc b/gpu/command_buffer/tests/gl_stream_draw_unittest.cc
index 636e0041c3801..60427231bbbff 100644
--- a/gpu/command_buffer/tests/gl_stream_draw_unittest.cc
+++ b/gpu/command_buffer/tests/gl_stream_draw_unittest.cc
@@ -6,6 +6,7 @@
 #include <GLES2/gl2ext.h>
 #include <stdint.h>
 
+#include "base/containers/span.h"
 #include "build/build_config.h"
 #include "gpu/command_buffer/tests/gl_manager.h"
 #include "gpu/command_buffer/tests/gl_test_utils.h"
@@ -79,11 +80,11 @@ TEST_F(GLStreamDrawTest, Basic) {
   GLTestHelper::SetupColorsForUnitQuad(color_loc, float_red, GL_STREAM_DRAW);
   glDrawArrays(GL_TRIANGLES, 0, 6);
   EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_red, nullptr));
+      GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_red, {}));
   GLTestHelper::SetupColorsForUnitQuad(color_loc, float_green, GL_STATIC_DRAW);
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_green,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_green, {}));
 
   GLTestHelper::CheckGLError("no errors", __LINE__);
 }
@@ -114,14 +115,14 @@ TEST_F(GLStreamDrawTest, DrawElements) {
       GL_ELEMENT_ARRAY_BUFFER, sizeof(indices), indices, GL_STREAM_DRAW);
   glDrawElements(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, nullptr);
   EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_red, nullptr));
+      GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_red, {}));
   GLTestHelper::SetupColorsForUnitQuad(color_loc, float_green, GL_STATIC_DRAW);
 
   glBufferData(
       GL_ELEMENT_ARRAY_BUFFER, sizeof(indices), indices, GL_STATIC_DRAW);
   glDrawElements(GL_TRIANGLES, 6, GL_UNSIGNED_BYTE, nullptr);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_green,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_green, {}));
 
   GLTestHelper::CheckGLError("no errors", __LINE__);
 }
@@ -161,13 +162,13 @@ TEST_F(GLStreamDrawTest, VertexArrayObjects) {
   for (int ii = 0; ii < 2; ++ii) {
     glBindVertexArrayOES(vaos[0]);
     glDrawArrays(GL_TRIANGLES, 0, 6);
-    EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_red,
-                                          nullptr));
+    EXPECT_TRUE(
+        GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_red, {}));
 
     glBindVertexArrayOES(vaos[1]);
     glDrawArrays(GL_TRIANGLES, 0, 6);
-    EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_green,
-                                          nullptr));
+    EXPECT_TRUE(
+        GLTestHelper::CheckPixels(0, 0, kSize, kSize, 0, expected_green, {}));
   }
 
   GLTestHelper::CheckGLError("no errors", __LINE__);
diff --git a/gpu/command_buffer/tests/gl_test_utils.cc b/gpu/command_buffer/tests/gl_test_utils.cc
index 843de44aa1ea7..26cc0498378b7 100644
--- a/gpu/command_buffer/tests/gl_test_utils.cc
+++ b/gpu/command_buffer/tests/gl_test_utils.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/40285824): Remove this and convert code to safer constructs.
 #pragma allow_unsafe_buffers
@@ -231,7 +233,7 @@ bool GLTestHelper::CheckPixels(GLint x,
                                GLsizei height,
                                GLint tolerance,
                                const uint8_t* color,
-                               const uint8_t* mask) {
+                               base::span<const uint8_t> mask) {
   std::vector<uint8_t> colors(width * height * 4);
   for (int i = 0; i < width * height * 4; i += 4)
     memcpy(&colors[i], color, 4);
@@ -244,7 +246,7 @@ bool GLTestHelper::CheckPixels(GLint x,
                                GLsizei height,
                                GLint tolerance,
                                const std::vector<uint8_t>& expected,
-                               const uint8_t* mask) {
+                               base::span<const uint8_t> mask) {
   GLsizei size = width * height * 4;
   std::vector<uint8_t> pixels(size, kCheckClearValue);
   glReadPixels(x, y, width, height, GL_RGBA, GL_UNSIGNED_BYTE, pixels.data());
@@ -258,7 +260,7 @@ bool GLTestHelper::CheckPixels(GLint x,
         uint8_t expected_component = expected[offset + jj];
         int diff = actual - expected_component;
         diff = diff < 0 ? -diff: diff;
-        if ((!mask || mask[jj]) && diff > tolerance) {
+        if ((mask.empty() || mask[jj]) && diff > tolerance) {
           EXPECT_EQ(static_cast<int>(expected_component),
                     static_cast<int>(actual))
               << " at " << (xx + x) << ", " << (yy + y) << " channel " << jj;
diff --git a/gpu/command_buffer/tests/gl_test_utils.h b/gpu/command_buffer/tests/gl_test_utils.h
index 79f9630656f18..e58ef46beba8d 100644
--- a/gpu/command_buffer/tests/gl_test_utils.h
+++ b/gpu/command_buffer/tests/gl_test_utils.h
@@ -13,6 +13,7 @@
 #include <string_view>
 #include <vector>
 
+#include "base/containers/span.h"
 #include "base/memory/raw_ptr.h"
 #include "build/build_config.h"
 #include "gpu/command_buffer/tests/gl_manager.h"
@@ -75,7 +76,7 @@ class GLTestHelper {
                           GLsizei height,
                           GLint tolerance,
                           const uint8_t* color,
-                          const uint8_t* mask);
+                          base::span<const uint8_t> mask);
 
   static bool CheckPixels(GLint x,
                           GLint y,
@@ -83,7 +84,7 @@ class GLTestHelper {
                           GLsizei height,
                           GLint tolerance,
                           const std::vector<uint8_t>& expected,
-                          const uint8_t* mask);
+                          base::span<const uint8_t> mask);
 
   // Uses ReadPixels to save an area of the current FBO/Backbuffer.
   static bool SaveBackbufferAsBMP(const char* filename, int width, int height);
diff --git a/gpu/command_buffer/tests/gl_texture_storage_unittest.cc b/gpu/command_buffer/tests/gl_texture_storage_unittest.cc
index 421b60acc2fad..d7b2fcbb2b849 100644
--- a/gpu/command_buffer/tests/gl_texture_storage_unittest.cc
+++ b/gpu/command_buffer/tests/gl_texture_storage_unittest.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/390223051): Remove C-library calls to fix the errors.
 #pragma allow_unsafe_libc_calls
@@ -128,7 +130,7 @@ TEST_F(TextureStorageTest, CorrectPixels) {
                   2, 2,
                   GL_RGBA, GL_UNSIGNED_BYTE,
                   source_pixels);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 2, 2, 0, source_pixels, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 2, 2, 0, source_pixels, {}));
 }
 
 TEST_F(TextureStorageTest, IsImmutable) {
@@ -258,8 +260,7 @@ TEST_F(TextureStorageTest, LuminanceEmulation) {
   BlitTexture();
 
   const uint8_t swizzled_pixel[4] = {1, 1, 1, 255};
-  EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 2, 2, 0, swizzled_pixel, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 2, 2, 0, swizzled_pixel, {}));
 }
 
 TEST_F(TextureStorageTest, AlphaEmulation) {
@@ -292,8 +293,7 @@ TEST_F(TextureStorageTest, AlphaEmulation) {
   BlitTexture();
 
   const uint8_t swizzled_pixel[4] = {0, 0, 0, 1};
-  EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 2, 2, 0, swizzled_pixel, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 2, 2, 0, swizzled_pixel, {}));
 }
 
 TEST_F(TextureStorageTest, LuminanceAlphaEmulation) {
@@ -326,8 +326,7 @@ TEST_F(TextureStorageTest, LuminanceAlphaEmulation) {
   BlitTexture();
 
   const uint8_t swizzled_pixel[4] = {1, 1, 1, 2};
-  EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 2, 2, 0, swizzled_pixel, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 2, 2, 0, swizzled_pixel, {}));
 }
 
 }  // namespace gpu
diff --git a/gpu/command_buffer/tests/gl_unittest.cc b/gpu/command_buffer/tests/gl_unittest.cc
index 41af10235df44..5dd8db782b7e9 100644
--- a/gpu/command_buffer/tests/gl_unittest.cc
+++ b/gpu/command_buffer/tests/gl_unittest.cc
@@ -7,6 +7,7 @@
 #include <stdint.h>
 
 #include "base/containers/heap_array.h"
+#include "base/containers/span.h"
 #include "gpu/command_buffer/service/feature_info.h"
 #include "gpu/command_buffer/tests/gl_manager.h"
 #include "gpu/command_buffer/tests/gl_test_utils.h"
@@ -31,7 +32,7 @@ TEST_F(GLTest, Basic) {
   uint8_t expected[] = {
       0, 255, 0, 255,
   };
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected, {}));
   GLTestHelper::CheckGLError("no errors", __LINE__);
 }
 
@@ -59,7 +60,7 @@ TEST_F(GLTest, BasicFBO) {
   uint8_t expected[] = {
       0, 255, 0, 255,
   };
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 16, 16, 0, expected, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 16, 16, 0, expected, {}));
   glDeleteFramebuffers(1, &fbo);
   glDeleteTextures(1, &tex);
   GLTestHelper::CheckGLError("no errors", __LINE__);
@@ -90,13 +91,12 @@ TEST_F(GLTest, SimpleShader) {
   };
   glClearColor(0.5f, 0.0f, 1.0f, 0.0f);
   glClear(GL_COLOR_BUFFER_BIT);
-  EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, 1, 1, 1, expected_clear, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 1, expected_clear, {}));
   uint8_t expected_draw[] = {
       0, 255, 0, 255,
   };
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_draw, nullptr));
+  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, 1, 1, 0, expected_draw, {}));
 }
 
 TEST_F(GLTest, FeatureFlagsMatchCapabilities) {
diff --git a/gpu/command_buffer/tests/gl_virtual_contexts_unittest.cc b/gpu/command_buffer/tests/gl_virtual_contexts_unittest.cc
index d14b13222b18d..1e3c13769abab 100644
--- a/gpu/command_buffer/tests/gl_virtual_contexts_unittest.cc
+++ b/gpu/command_buffer/tests/gl_virtual_contexts_unittest.cc
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "base/containers/span.h"
+
 #ifdef UNSAFE_BUFFERS_BUILD
 // TODO(crbug.com/40285824): Remove this and convert code to safer constructs.
 #pragma allow_unsafe_buffers
@@ -156,7 +158,7 @@ void TestDraw(int size) {
   glClearColor(0.5f, 0.0f, 1.0f, 0.0f);
   glClear(GL_COLOR_BUFFER_BIT);
   EXPECT_TRUE(
-      GLTestHelper::CheckPixels(0, 0, size, size, 1, expected_clear, nullptr));
+      GLTestHelper::CheckPixels(0, 0, size, size, 1, expected_clear, {}));
   glDrawArrays(GL_TRIANGLES, 0, 6);
 }
 
@@ -195,7 +197,7 @@ TEST_P(GLVirtualContextsTest, Basic) {
     GLManager* gl_manager = test.manager;
     gl_manager->MakeCurrent();
     EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, test.size, test.size, 0,
-                                          test.color, nullptr));
+                                          test.color, {}));
   }
 
   for (int ii = 0; ii < kNumTests; ++ii) {
@@ -227,16 +229,16 @@ TEST_P(GLVirtualContextsTest, VertexArrayObjectRestore) {
   gl1_.MakeCurrent();
   // Test to ensure that vao1 is still the active VAO for this context.
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize1, kSize1, 0, kExpectedRed,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, kSize1, kSize1, 0, kExpectedRed, {}));
   glFinish();
   GLTestHelper::CheckGLError("no errors", __LINE__);
 
   gl2_.MakeCurrent();
   // Test to ensure that vao2 is still the active VAO for this context.
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize2, kSize2, 0, kExpectedGreen,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, kSize2, kSize2, 0, kExpectedGreen, {}));
   glFinish();
   GLTestHelper::CheckGLError("no errors", __LINE__);
 }
@@ -265,8 +267,8 @@ TEST_P(GLVirtualContextsTest, VertexArrayObjectRestoreRebind) {
   glBindVertexArrayOES(0);
   glBindVertexArrayOES(vao1);
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize1, kSize1, 0, kExpectedRed,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, kSize1, kSize1, 0, kExpectedRed, {}));
   glFinish();
   GLTestHelper::CheckGLError("no errors", __LINE__);
 
@@ -276,8 +278,8 @@ TEST_P(GLVirtualContextsTest, VertexArrayObjectRestoreRebind) {
   glBindVertexArrayOES(0);
   glBindVertexArrayOES(vao2);
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize2, kSize2, 0, kExpectedGreen,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, kSize2, kSize2, 0, kExpectedGreen, {}));
   glFinish();
 
   GLTestHelper::CheckGLError("no errors", __LINE__);
@@ -304,8 +306,8 @@ TEST_P(GLVirtualContextsTest, VertexArrayObjectRestoreDefault) {
   gl1_.MakeCurrent();
   // Test to ensure that default VAO on gl1_ is still valid.
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize1, kSize1, 0, kExpectedRed,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, kSize1, kSize1, 0, kExpectedRed, {}));
   glFinish();
 
   gl2_.MakeCurrent();
@@ -314,8 +316,8 @@ TEST_P(GLVirtualContextsTest, VertexArrayObjectRestoreDefault) {
   // bound during the context switch.
   glBindVertexArrayOES(0);
   glDrawArrays(GL_TRIANGLES, 0, 6);
-  EXPECT_TRUE(GLTestHelper::CheckPixels(0, 0, kSize2, kSize2, 0, kExpectedGreen,
-                                        nullptr));
+  EXPECT_TRUE(
+      GLTestHelper::CheckPixels(0, 0, kSize2, kSize2, 0, kExpectedGreen, {}));
   glFinish();
 
   GLTestHelper::CheckGLError("no errors", __LINE__);
```

## Build Failure Log

```

27.24s Build Failure: 64 done 1 failed 8573 remaining - 2.35/s
 1 steps failed: remote-exec 3d8940b16046258aed7f13bf39150072065f071b96944863ea31f3e76ddacae8/355 failed: exit=1
see ./out/linux/siso_output for full command line and output
 or ./out/linux/siso.INFO
use ./out/linux/siso_failed_commands.sh to re-run failed commands
real	0m27.622s
user	5m54.735s
sys	3m20.578s
ninja: Entering directory `out/linux'
init credentials done 52.073175ms
reapi instance: projects/rbe-chrome-untrusted/instances/default_instance
loading fs state done 1.159923364s
loading/recompacting deps log done 13.42Âµs
load siso config done 808.51294ms
load build.ninja done 1.56521896s
schedule pending:0+ready:1 (node:324309 edge:2)
build start: Ready 1 Pending 1
rebuild manifest finished	
schedule pending:0+ready:1 (node:324309 edge:9)
schedule pending:82237+ready:9517 (node:324309 edge:91757)
 1.49s schedule pending:109791+ready:13477 (node:324309 edge:123268)
build start: Ready 13477 Pending 109791
FAILED: 05a37e29-84ec-4a62-a30d-4f30d8e5c241 "./obj/gpu/gl_tests/gl_copy_texture_CHROMIUM_unittest.o" CXX obj/gpu/gl_tests/gl_copy_texture_CHROMIUM_unittest.o
err: remote-exec 3d8940b16046258aed7f13bf39150072065f071b96944863ea31f3e76ddacae8/355 failed: exit=1
../../third_party/llvm-build/Release+Asserts/bin/clang++ -MMD -MF obj/gpu/gl_tests/gl_copy_texture_CHROMIUM_unittest.o.d -DGL_GLEXT_PROTOTYPES -DDCHECK_ALWAYS_ON=1 -DUSE_UDEV -DUSE_AURA=1 -DUSE_GLIB=1 -DUSE_OZONE=1 -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D_FORTIFY_SOURCE=2 -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_GNU_SOURCE -DCR_CLANG_REVISION=\"llvmorg-21-init-9266-g09006611-2\" -D_LIBCPP_HARDENING_MODE=_LIBCPP_HARDENING_MODE_EXTENSIVE -D_LIBCPP_DISABLE_VISIBILITY_ANNOTATIONS -D_LIBCXXABI_DISABLE_VISIBILITY_ANNOTATIONS -D_LIBCPP_INSTRUMENTED_WITH_ASAN=0 -DCR_LIBCXX_REVISION=f034fd5662d033c281ab6a9b45164066ddd18809 -DCR_SYSROOT_KEY=20250129T203412Z-1 -DNDEBUG -DNVALGRIND -DDYNAMIC_ANNOTATIONS_ENABLED=0 -DGLIB_VERSION_MAX_ALLOWED=GLIB_VERSION_2_56 -DGLIB_VERSION_MIN_REQUIRED=GLIB_VERSION_2_56 -DSK_ENABLE_SKSL -DSK_UNTIL_CRBUG_1187654_IS_FIXED -DSK_USER_CONFIG_HEADER=\"../../skia/config/SkUserConfig.h\" -DSK_WIN_FONTMGR_NO_SIMULATIONS -DSK_DISABLE_LEGACY_INIT_DECODERS -DSK_CODEC_DECODES_JPEG -DSK_CODEC_ENCODES_JPEG -DSK_GAMMA_EXPONENT=1.2 -DSK_GAMMA_CONTRAST=0.2 -DSK_GANESH -DSK_GPU_WORKAROUNDS_HEADER=\"gpu/config/gpu_driver_bug_workaround_autogen.h\" -DSK_GL -DSK_VULKAN=1 -DSK_GRAPHITE -DSK_DAWN -DVK_USE_PLATFORM_XCB_KHR -DVK_USE_PLATFORM_XLIB_KHR -DVK_USE_PLATFORM_WAYLAND_KHR -DCHROMIUM -DLIBYUV_DISABLE_NEON -DLIBYUV_DISABLE_SVE -DLIBYUV_DISABLE_SME -DLIBYUV_DISABLE_LSX -DLIBYUV_DISABLE_LASX -DBENCHMARK_STATIC_DEFINE -DU_USING_ICU_NAMESPACE=0 -DU_ENABLE_DYLOAD=0 -DUSE_CHROMIUM_ICU=1 -DU_ENABLE_TRACING=1 -DU_ENABLE_RESOURCE_TRACING=0 -DU_STATIC_IMPLEMENTATION -DICU_UTIL_DATA_IMPL=ICU_UTIL_DATA_FILE -DCRASHPAD_ZLIB_SOURCE_EXTERNAL -DGTEST_API_= -DGTEST_HAS_POSIX_RE=0 -DGTEST_HAS_ABSL -DGTEST_NO_ABSL_FLAGS -DUNIT_TEST -DUSE_GIO -DANGLE_DELEGATE_WORKERS=1 -DANGLE_USE_ABSEIL -DABSL_ALLOCATOR_NOTHROW=1 -DGOOGLE_PROTOBUF_NO_RTTI -DHAVE_PTHREAD -DVK_NO_PROTOTYPES -DUSE_VULKAN_XCB -I../.. -Igen -I../../buildtools/third_party/libc++ -I../../third_party/khronos -I../../gpu -I../../third_party/perfetto/include -Igen/third_party/perfetto/build_config -Igen/third_party/perfetto -I../../net/third_party/quiche/overrides -I../../net/third_party/quiche/src/quiche/common/platform/default -I../../net/third_party/quiche/src -I../../third_party/skia -Igen/third_party/skia -I../../third_party/wuffs/src/release/c -I../../third_party/vulkan-headers/src/include -I../../third_party/wayland/src/src -I../../third_party/wayland/include/src -Igen/third_party/dawn/include -I../../third_party/dawn/include -I../../third_party/libyuv/include -I../../third_party/google_benchmark/src/include -I../../base/allocator/partition_allocator/src -Igen/base/allocator/partition_allocator/src -I../../third_party/abseil-cpp -I../../third_party/boringssl/src/include -I../../third_party/protobuf/src -I../../third_party/ipcz/include -I../../third_party/ced/src -I../../third_party/icu/source/common -I../../third_party/icu/source/i18n -I../../third_party/crashpad/crashpad -I../../third_party/crashpad/crashpad/compat/linux -I../../third_party/crashpad/crashpad/compat/non_win -I../../third_party/zlib -I../../third_party/angle/include -I../../third_party/mesa_headers -I../../third_party/googletest/custom -I../../third_party/googletest/src/googlemock/include -I../../third_party/googletest/src/googletest/include -I../../third_party/re2/src -I../../third_party/angle/src/common/base -I../../third_party/angle/src/common/third_party/xxhash -Igen/net/third_party/quiche/src -I../../third_party/wayland/include -I../../third_party/wayland/src/cursor -I../../third_party/wayland/src/egl -Igen/third_party/wayland/src/protocol -Wall -Wextra -Wimplicit-fallthrough -Wextra-semi -Wunreachable-code-aggressive -Wthread-safety -Wgnu -Wno-gnu-anonymous-struct -Wno-gnu-conditional-omitted-operand -Wno-gnu-include-next -Wno-gnu-label-as-value -Wno-gnu-redeclared-enum -Wno-gnu-statement-expression -Wno-gnu-zero-variadic-macro-arguments -Wno-zero-length-array -Wno-missing-field-initializers -Wno-unused-parameter -Wno-psabi -Wloop-analysis -Wno-unneeded-internal-declaration -Wno-cast-function-type -Wno-thread-safety-reference-return -Wno-nontrivial-memcall -Wshadow -Werror -fno-delete-null-pointer-checks -fno-strict-overflow -fno-ident -fno-strict-aliasing -fstack-protector -funwind-tables -fPIC -pthread -fcolor-diagnostics -fmerge-all-constants -fno-sized-deallocation -fcrash-diagnostics-dir=../../tools/clang/crashreports -mllvm -instcombine-lower-dbg-declare=0 -mllvm -split-threshold-for-reg-with-hint=0 -ffp-contract=off -Wa,--crel,--allow-experimental-crel -fextend-variable-liveness=none -fcomplete-member-pointers -m64 -msse3 -Wno-builtin-macro-redefined -D__DATE__= -D__TIME__= -D__TIMESTAMP__= -ffile-compilation-dir=. -no-canonical-prefixes -Xclang --warning-suppression-mappings=../../build/config/warning_suppression.txt -ftrivial-auto-var-init=pattern -O2 -fdata-sections -ffunction-sections -fno-unique-section-names -fno-math-errno -fno-omit-frame-pointer -g0 -fvisibility=hidden -Wheader-hygiene -Wstring-conversion -Wtautological-overlap-compare -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/include/glib-2.0 -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/lib/x86_64-linux-gnu/glib-2.0/include -Wno-redundant-parens -Wno-redundant-parens -Wno-inconsistent-missing-override -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/include/glib-2.0 -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/lib/x86_64-linux-gnu/glib-2.0/include -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/include/libmount -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/include/blkid -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/include/gio-unix-2.0 -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/include/nss -isystem../../build/linux/debian_bullseye_amd64-sysroot/usr/include/nspr -Wno-invalid-offsetof -Wenum-compare-conditional -Wno-nullability-completeness -std=c++20 -Wno-trigraphs -gsimple-template-names -fno-exceptions -fno-rtti -nostdinc++ -isystem../../third_party/libc++/src/include -isystem../../third_party/libc++abi/src/include --sysroot=../../build/linux/debian_bullseye_amd64-sysroot -fvisibility-inlines-hidden  -c ../../gpu/command_buffer/tests/gl_copy_texture_CHROMIUM_unittest.cc -o obj/gpu/gl_tests/gl_copy_texture_CHROMIUM_unittest.o
build step: cxx "./obj/gpu/gl_tests/gl_copy_texture_CHROMIUM_unittest.o"
siso_rule: clang/cxx
stdout:
../../gpu/command_buffer/tests/gl_copy_texture_CHROMIUM_unittest.cc:334:20: error: incompatible operand types ('uint8_t[4]' (aka 'unsigned char[4]') and 'std::array<uint8_t, 4>' (aka 'array<unsigned char, 4>'))
  334 |               (alt ? alt_expected_color : expected_color)[j];
      |                    ^ ~~~~~~~~~~~~~~~~~~   ~~~~~~~~~~~~~~
1 error generated.
build failed	
local:50 remote:12 cache:2 fallback:0 retry:0 skip:114631
reapi: ops: 130(err:57) / r:29(err:0) 1.58MiB / w:197(err:0) 298.72KiB
fs: ops: 17710(err:8287) / r:2041(err:0) 6.72GiB / w:62(err:2) 27.00MiB
```
